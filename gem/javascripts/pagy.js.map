{
  "version": 3,
  "sources": ["../../src/pagy.ts"],
  "sourcesContent": [
    "interface SyncData {\n  from?: number\n  to?:   number\n  key:   string\n  str?:  string\n}\ntype InitArgs = [\"k\",  KeynavArgs] |          // series_nav[_js] with keynav instance\n                [\"snj\", SeriesNavJsArgs] |    // series_nav_js\n                [\"inj\", InputNavJsArgs] |     // input_nav_js\n                [\"ltj\", LimitTagJsArgs]       // limit_tag_js\ntype AugmentKeynav = (nav:HTMLElement, keynavArgs:KeynavArgs) => Promise<((page: string) => string)>\ntype KeynavArgs = readonly [storageKey:  string | null,\n                            rootKey:     string | null,\n                            pageKey:     string,\n                            last:        number,\n                            spliceArgs?: SpliceArgs]\ntype SpliceArgs = readonly [start:       number,\n                            deleteCount: number,     // it would be optional, but ts complains\n                            ...items:    Cutoff[]]\ntype Cutoff = readonly (string | number | boolean)[]\ntype AugmentedPage = [browserId:   string,\n                      storageKey:  string,\n                      pageNumber:  number,\n                      pages:       number,\n                      priorCutoff: Cutoff | null,\n                      pageCutoff:  Cutoff | null]\ntype SeriesNavJsArgs = readonly [NavJsTokens, NavJsSeries, KeynavArgs?]\ntype NavJsSeries = readonly [widths: number[],\n                             series: (string | number)[][],\n                             labels: string[][] | null]\ntype InputNavJsArgs = readonly [urlToken: string, KeynavArgs?]\ntype LimitTagJsArgs = readonly [from:     number,\n                                urlToken: string]\ntype NavJsTokens = readonly [before:  string,\n                             anchor:  string,\n                             current: string,\n                             gap:     string,\n                             after:   string]\ninterface NavJsElement extends HTMLElement {\n  render(): void\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst Pagy = (() => {\n  const storageSupport = 'sessionStorage' in window && 'BroadcastChannel' in window,\n        pageRe         = \"P \";  // shorten the compiled size\n  // eslint-disable-next-line prefer-const\n  let pagy = \"pagy\", storage: Storage, sync: BroadcastChannel, tabId: number;\n  if (storageSupport) {\n    storage = sessionStorage; // shorten the compiled size\n    sync    = new BroadcastChannel(pagy);\n    tabId   = Date.now();\n    // Sync the sessionStorage keys for the cutoffs opened in a new tab/window\n    sync.addEventListener(\"message\", (e:MessageEvent<SyncData>) => {\n      if (e.data.from) { // request cutoffs\n        const cutoffs = storage.getItem(e.data.key);\n        if (cutoffs) {\n          sync.postMessage(<SyncData>{to: e.data.from, key: e.data.key, str: cutoffs});\n        } // send response\n      } else if (e.data.to) {  // receive cutoffs\n        if (e.data.to == tabId) {\n          storage.setItem(e.data.key, <string>e.data.str);\n        }\n      }\n    });\n  }\n  // The observer instance for responsive navs\n  const rjsObserver = new ResizeObserver(\n      entries => entries.forEach(e => {\n        e.target.querySelectorAll<NavJsElement>(\".pagy-rjs\").forEach(el => el.render());\n      }));\n\n  /* Full set of B64 functions\n  const B64Encode     = (unicode:string) => btoa(String.fromCharCode(...(new TextEncoder).encode(unicode))),\n        B64Safe       = (unsafe:string)  => unsafe.replace(/[+/=]/g, (m) => m == \"+\" ? \"-\" : m == \"/\" ? \"_\" : \"\"),\n        B64SafeEncode = (unicode:string) => B64Safe(B64Encode(unicode)),\n        B64Decode     = (base64:string)  => (new TextDecoder()).decode(Uint8Array.from(atob(base64), c => c.charCodeAt(0))),\n        B64Unsafe     = (safe:string)    => safe.replace(/[-_]/g, (match) => match == \"-\" ? \"+\" : \"/\"),\n        B64SafeDecode = (base64:string)  => B64Decode(B64Unsafe(base64))\n  */\n  const B64SafeEncode = (unicode:string) => btoa(String.fromCharCode(...(new TextEncoder).encode(unicode)))\n                                            .replace(/[+/=]/g, (m) => m == \"+\" ? \"-\" : m == \"/\" ? \"_\" : \"\"),\n        B64Decode     = (base64:string)  => (new TextDecoder()).decode(Uint8Array.from(atob(base64), c => c.charCodeAt(0)));\n\n  // Return a random key: 3 chars max, base-36 number < 36**3\n  const randKey = () => Math.floor(Math.random() * 36 ** 3).toString(36);\n\n  // Manage the page augmentation for Keynav, called only if storageSupport\n  const augmentKeynav: AugmentKeynav = async (nav, [storageKey, rootKey, pageKey, last, spliceArgs]) => {\n    let augmentPage:(page: string) => string;\n    const browserKey = document.cookie.split(/;\\s+/)  // it works even if malformed\n                               .find((row) => row.startsWith(pagy + \"=\"))\n                               ?.split(\"=\")[1] ?? randKey();\n    document.cookie = pagy + \"=\" + browserKey;  // Smaller .min size: set the cookie without checking\n    if (storageKey && !(storageKey in storage)) {\n      // Sync the sessiongStorage from other tabs/windows (e.g., open page in the new tab/window)\n      sync.postMessage(<SyncData>{ from: tabId, key: storageKey });\n      // Wait for the listener to copy the cutoffs in the current sessionStorage\n      await new Promise<string|null>((resolve) => setTimeout(() => resolve(\"\"), 100));\n      if (!(storageKey in storage)) { // the storageKey didn't get copied: fallback to countless pagination\n        augmentPage = (page: string) => page + '+' + last;\n      }\n    }\n    // @ts-expect-error If it is not assigned it means it supports keynav\n    if (!augmentPage) { // regular keynav pagination\n      if (!storageKey) { do { storageKey = randKey() } while (storageKey in storage) } // no dup keys\n      const data = storage.getItem(storageKey),\n          cutoffs = <Cutoff[]>(data ? JSON.parse(data) : [undefined]);\n      if (spliceArgs) {\n        cutoffs.splice(...spliceArgs);\n        storage.setItem(storageKey, JSON.stringify(cutoffs));\n      }\n      // Augment function\n      augmentPage = (page:string) => {\n        const pageNum = parseInt(page);\n        return B64SafeEncode(JSON.stringify(\n            <AugmentedPage>[browserKey,\n                            storageKey,\n                            pageNum,\n                            cutoffs.length,       // pages/last\n                            cutoffs[pageNum - 1], // priorCutoff\n                            cutoffs[pageNum]]));  // pageCutoff\n      };\n    }\n    const search = (rootKey) ? `${rootKey}%5B${pageKey}%5D` : pageKey;\n    const re     = new RegExp(`(?<=\\\\?.*)(\\\\b${search}=)(\\\\d+)`);\n    // Augment the page param of each href\n    for (const a of <NodeListOf<HTMLAnchorElement>><unknown>nav.querySelectorAll('a[href]')) {\n      a.href = a.href.replace(re, (_match, prefix, digit): string => `${prefix}${augmentPage(<string>digit)}`);\n    }\n    // Return the augment function for further augmentation (i.e., url token in input_nav_js)\n    return augmentPage;\n  };\n\n  // Build the series_nav_js helper\n  const buildNavJs = (nav:NavJsElement, [[before, anchor, current, gap, after],\n                                        [widths, series, labels], keynavArgs]:SeriesNavJsArgs) => {\n    const  parent = <HTMLElement>nav.parentElement;\n    let lastWidth = -1;\n    (nav.render = () => {\n      const index = widths.findIndex(w => w < parent.clientWidth);\n      if (widths[index] === lastWidth) { return } // no change: abort\n\n      let html = before;\n      series[index].forEach((item, i) => {\n        // Avoid the if blocks and chain the results (shorter pagy.min.js and easier reading)\n        html += item == \"gap\" ? gap :\n                // @ts-expect-error the item may be a number, but the 'replace' converts it to string (shorter pagy.min.js)\n                (typeof item == \"number\" ? anchor.replace(pageRe, item) : current)\n                    .replace(\"L<\", labels?.[index][i] ?? item + \"<\");\n      });\n      html         += after;\n      nav.innerHTML = \"\";\n      nav.insertAdjacentHTML(\"afterbegin\", html);\n      lastWidth = widths[index];\n      if (keynavArgs && storageSupport) { void augmentKeynav(nav, keynavArgs) }\n    })();\n    if (nav.classList.contains(pagy + \"-rjs\")) { rjsObserver.observe(parent) }\n  };\n\n  // Init the input_nav_js helpers\n  const initInputNavJs = async (nav:HTMLElement, [url_token, keynavArgs]:InputNavJsArgs) => {\n    const augment = keynavArgs && storageSupport\n                    ? await augmentKeynav(nav, keynavArgs)\n                    : (page: string) => page;\n    initInput(nav, inputValue => url_token.replace(pageRe, augment(inputValue)));\n  };\n\n  // Init the limit_tag_js helper\n  const initLimitTagJs = (span:HTMLSpanElement, [from, url_token]:LimitTagJsArgs) => {\n    initInput(span, inputValue => {\n      // @ts-expect-error the page is a number, but the 'replace' converts it to string (shorter pagy.min.js)\n      return url_token.replace(pageRe, Math.max(Math.ceil(from / parseInt(inputValue)), 1))\n                      .replace('L ', inputValue);\n    });\n  };\n\n  // Init the input element\n  const initInput = (element:HTMLElement, getUrl:(v:string) => string) => {\n    const input   = <HTMLInputElement>element.querySelector(\"input\"),\n          link    = <HTMLAnchorElement>element.querySelector(\"a\"),\n          initial = input.value,\n          action  = () => {\n                      if (input.value === initial) { return }  // not changed\n                      const [min, val, max] = [input.min, input.value, input.max].map(n => parseInt(n) || 0);\n                      if (val < min || val > max) {  // reset invalid/out-of-range\n                        input.value = initial;\n                        input.select();\n                        return;\n                      }\n                      link.href = getUrl(input.value);\n                      link.click();\n                    };\n    input.addEventListener(\"focus\", () => input.select());\n    input.addEventListener(\"focusout\", action);\n    input.addEventListener(\"keypress\", e => { if (e.key == \"Enter\") { action() } });\n  };\n\n  // Public interface\n  return {\n    version: \"43.2.0\",\n\n    // Scan for elements with a \"data-pagy\" attribute and call their init functions with the decoded args\n    init(arg?:HTMLElement) {\n      const target   = arg instanceof HTMLElement ? arg : document,\n            elements = target.querySelectorAll(\"[data-pagy]\");\n      for (const element of <NodeListOf<HTMLElement>>elements) {\n        try {\n          const [helperId, ...args] = <InitArgs>JSON.parse(B64Decode(<string>element.getAttribute(\"data-pagy\")));\n          if (helperId == \"k\") {\n            // @ts-expect-error spread 2 arguments, not 3 as it complains about\n            void augmentKeynav(element, ...<KeynavArgs><unknown>args);\n          } else if (helperId == \"snj\") {\n            buildNavJs(<NavJsElement>element, <SeriesNavJsArgs><unknown>args);\n          } else if (helperId == \"inj\") {\n            void initInputNavJs(element, <InputNavJsArgs><unknown>args);\n          } else if (helperId == \"ltj\") {\n            initLimitTagJs(element, <LimitTagJsArgs><unknown>args);\n          }\n          // else { console.warn(\"Pagy.init: %o\\nUnknown helperId '%s'\", element, helperId) }\n        } catch (err) { console.warn(\"Pagy.init: %o\\n%s\", element, err) }\n      }\n    }\n  };\n})();\n"
  ],
  "mappings": "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",
  "debugId": "E46E32F1566B8C2964756E2164756E21",
  "names": []
}